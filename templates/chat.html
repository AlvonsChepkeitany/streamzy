{% extends "base.html" %}

{% block title %}Streamzy - Terminal Chat{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block content %}
<div class="chat-container">
    <!-- Sidebar - Rooms & Users Panel -->
    <aside class="sidebar" id="sidebar">
        <!-- Rooms Section -->
        <div class="sidebar-section">
            <div class="sidebar-header">
                <h3 class="sidebar-title">
                    <span class="icon">ğŸ“</span> ROOMS
                </h3>
                <button class="btn-small" id="joinRoomBtn" title="Join Room">+</button>
            </div>
            <div class="room-list" id="roomList">
                <div class="no-rooms">No rooms joined yet</div>
            </div>
        </div>
        
        <!-- Users Section -->
        <div class="sidebar-section">
            <div class="sidebar-header">
                <h3 class="sidebar-title">
                    <span class="icon">ğŸ‘¥</span> ONLINE
                </h3>
                <span class="user-count" id="userCount">0</span>
            </div>
            <div class="user-list" id="userList">
                <!-- Users will be populated here -->
            </div>
        </div>
        
        <div class="sidebar-footer">
            <div class="current-room">
                <span class="label">ROOM:</span>
                <span class="room-name" id="currentRoom">none</span>
            </div>
        </div>
    </aside>
    
    <!-- Main Terminal Area -->
    <main class="main-terminal">
        <div class="terminal-window fullscreen">
            <div class="terminal-header">
                <span class="terminal-title" id="terminalTitle">
                    STREAMZY_TERMINAL :: {{ user.username }}@none
                </span>
                <div class="terminal-controls">
                    <button class="control-btn" id="toggleSidebar" title="Toggle Sidebar">
                        <span class="icon">â˜°</span>
                    </button>
                    <button class="control-btn" id="clearTerminal" title="Clear Terminal">
                        <span class="icon">âŒ«</span>
                    </button>
                    <button class="control-btn danger" id="logoutBtn" title="Logout">
                        <span class="icon">â»</span>
                    </button>
                </div>
            </div>
            
            <div class="terminal-body" id="terminalBody">
                <div class="terminal-output" id="terminalOutput">
                    <!-- Welcome message -->
                    <div class="output-line system">
                        <pre class="ascii-art welcome">
 â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—  â•‘
 â•‘  â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•  â•‘
 â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â•  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â•‘
 â•‘  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•    â•šâ–ˆâ–ˆâ•”â•    â•‘
 â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘     â•‘
 â•‘  â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•     â•‘
 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        </pre>
                    </div>
                    <div class="output-line system">
                        <span class="prompt">SYSTEM://</span>
                        <span class="text">Welcome to Streamzy Secure Communications</span>
                    </div>
                    <div class="output-line system">
                        <span class="prompt">SYSTEM://</span>
                        <span class="text">All messages are end-to-end encrypted</span>
                    </div>
                    <div class="output-line system">
                        <span class="prompt">SYSTEM://</span>
                        <span class="text">Join a room to start chatting. Click [+] or use /join &lt;room&gt; &lt;password&gt;</span>
                    </div>
                    <div class="output-line system separator">
                        <span class="text">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
                    </div>
                </div>
                
                <!-- Typing indicator -->
                <div class="typing-indicator hidden" id="typingIndicator">
                    <span class="typing-user"></span> is typing<span class="typing-dots">...</span>
                </div>
            </div>
            
            <!-- Input area -->
            <div class="terminal-input-area">
                <div class="input-line">
                    <span class="input-prompt">
                        <span class="username">{{ user.username }}</span>
                        <span class="separator">@</span>
                        <span class="room" id="inputRoom">none</span>
                        <span class="cursor-symbol">&gt;</span>
                    </span>
                    <input type="text" 
                           id="messageInput" 
                           class="terminal-input-field"
                           placeholder="Join a room to start chatting..."
                           autocomplete="off"
                           maxlength="2000">
                </div>
                <div class="input-info">
                    <span class="char-count">
                        <span id="charCount">0</span>/2000
                    </span>
                    <span class="connection-status" id="connectionStatus">
                        <span class="status-dot connecting"></span>
                        <span class="status-text">Connecting...</span>
                    </span>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Join Room Modal -->
<div class="modal hidden" id="joinRoomModal">
    <div class="modal-content terminal-style">
        <div class="modal-header">
            <h3>JOIN ROOM</h3>
            <button class="close-btn" onclick="closeJoinModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Room Name:</label>
                <input type="text" id="joinRoomName" placeholder="Enter room name" class="terminal-input">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="joinRoomPassword" placeholder="Enter room password" class="terminal-input">
            </div>
            <div class="error-msg hidden" id="joinError"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="submitJoinRoom()">JOIN</button>
            <button class="btn btn-secondary" onclick="closeJoinModal()">CANCEL</button>
        </div>
    </div>
</div>

<!-- Hidden data for JS -->
<script>
    window.currentUser = {
        id: {{ user.id }},
        username: "{{ user.username }}",
        isAdmin: {{ 'true' if user.is_admin else 'false' }}
    };
</script>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/terminal.js') }}"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
